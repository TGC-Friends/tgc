{% extends "base.html" %}
{% load static %}

{% block title %} ~ Welcome to the Gown Connoisseur ~ {% endblock %}

{% block css %}
	{% include 'statics/css.html' %}
	<link href="https://unpkg.com/gijgo@1.9.11/css/gijgo.min.css" rel="stylesheet" type="text/css" />
{% endblock %}

{% block topnavbar %}
{% endblock %}

{% block content %}
	<div class='container'>
		
				<!-- logo -->
				<div class="d-flex flex-row justify-content-center my-3">
					<div class="col-6" style="">
						<img class="" src="{% static 'images/logoBlack.png' %}" style=" width: 100%;">
					</div>
				</div>

				
				<div class="d-flex flex-row justify-content-center my-3">
					<div class="col-10 col-sm-12 col-md-12">
						<form method="post" id="formdetaillog">
						<!-- <form action="/submitformdetails/" method="post" id="formdetaillog"> -->
						{% csrf_token %}
						<!-- description -->
						<p>
						Hello! We would like to find out more about your preferences to ensure that you have a wonderful and fulfilling experience with us. This checklist will help to frame an idea of the dream gown that you are looking for. Sit back, relax and enjoy while you take time to ponder on your dream gown!
						</p>

						<!-- main form -->
						<div class="border border-dark" style="">
							<div class="border border-dark text-center font-weight-bold p-2">
								Personal Information
							</div>

							<div class="d-flex border border-dark pb-3">
								
								<span class="col-6">
									<div class="m-1">Name of Bride:</div>
									{{ formfields.bridename}}
								</span>
								<span class="col-6">
									<div class="m-1">Name of Groom:</div>{{ formfields.groomname}}
								</span>
								
							</div>

							<div class="d-flex">
								<div class="col-3 border border-dark pb-2	">
									<div class="m-1">Phone:</div>
									{{ formfields.phonenum}}
								</div>

								<div class="col-3 border border-dark pb-2">
									<div class="m-1">Email:</div>
									{{ formfields.emailfield}}
								</div>

								<div class="col-6 border border-dark pb-2">
									<div class="m-1">How did you hear of us?</div>
									{{ formfields.howdidyouhear}}
								</div>

							</div>

							<div class="border border-dark text-center font-weight-bold p-2">
								Event Details
							</div>

							<!-- Event 1 -->
							<div class="d-flex ">
								
								<div class="col-3 border border-dark pb-2">
									<div class="m-1">Event Date</div>
									{{ formfields.eventdate1}}
								</div>

								<div class="col-4 border border-dark pb-2">
									<div class="m-1">Event Type</div>
									{{ formfields.eventtype1}}
								</div>

								<div class="col-5 border border-dark pb-2">
									<div class="m-1">Event Venue</div>
									{{ formfields.eventvenue1}}
								</div>

							</div>

							<!-- Event 2 -->
							<div class="d-flex">
								
								<div class="col-3 border border-dark pb-2">
									<div class="m-1">Event Date</div>
									{{ formfields.eventdate2}}
								</div>

								<div class="col-4 border border-dark pb-2">
									<div class="m-1">Event Type</div>
									{{ formfields.eventtype2}}
								</div>

								<div class="col-5 border border-dark pb-2">
									<div class="m-1">Event Venue</div>
									{{ formfields.eventvenue2}}
								</div>

							</div>

							<!-- Event 3 -->
							<div class="d-flex">
								
								<div class="col-3 border border-dark pb-2">
									<div class="m-1">Event Date</div>
									{{ formfields.eventdate3}}
								</div>

								<div class="col-4 border border-dark pb-2">
									<div class="m-1">Event Type</div>
									{{ formfields.eventtype3}}
								</div>

								<div class="col-5 border border-dark pb-2">
									<div class="m-1">Event Venue</div>
									{{ formfields.eventvenue3}}
								</div>

							</div>

							<div class="border border-dark text-center font-weight-bold p-2">Gown Preferences</div>
							<div class="d-flex ">

								<div class="col-8 border border-dark pb-2">
									<div class="m-1 my-2">Required Outfit (Please Tick): </div>

									<div class="d-flex w-100">
									{% for box in formfields.requiredoutfit %}
										<label class="d-flex mx-1 flex-fill align-items-center" for="{{ box.id_for_label }}">
											<span class="mx-1 col-6 align-middle">{{ box.choice_label }}</span>
											<span class="radio col-4 align-middle">{{ box.tag }}</span>
										</label>
									{% endfor %}
									</div>
								</div>

								<div class="col-4 border border-dark pb-2">
									
									<div class="m-1 my-2">No. of gowns required:</div>
									<div class="d-flex justify-content-center align-items-center align-self-center w-100">
								
											{{ formfields.noofgowns }}
									
									</div>
								</div>
							</div>

							<div class="col-12 border border-dark">
								
								<div class="m-1 my-2">Preferred Silhouette (Please Tick): </div>

									<div class="d-flex w-100 flex-wrap">
									{% for box in formfields.preferredoutfit %}
										<div class="d-flex flex-column col-3 p-0 my-3 align-items-center" for="{{ box.id_for_label }}">
											
											<div class="d-flex my-1 w-100 justify-content-center align-items-center">
												<span class="mx-2 align-middle">{{ box.choice_label }}</span>
												<span class="radio align-middle">{{ box.tag }}</span>
											</div>

											{% with 'images/'|add:box.choice_label|add:'.jpg' as image_path %}
											<img class="" src="{% static image_path %}" style="width:85%;">
											{% endwith %}
										
										</div>
									{% endfor %}
									</div>

								<div class="my-2 d-flex w-100">
									<span class="align-self-center" style="vertical-align: middle;">Others: </span>
									<span class="flex-fill">{{ formfields.preferredoutOthers }}</span>
								</div>
							</div>						

							<div class="col-12 border border-dark">
								<div class="m-1 my-2">Preferred Details: </div>

									<div class="d-flex w-100">
									{% for box in formfields.preferredstyle %}
										<label class="d-flex mx-1 flex-fill justify-content-center align-items-center" for="{{ box.id_for_label }}">
											<span class="mx-2 align-middle">{{ box.choice_label }}</span>
											<span class="radio align-middle">{{ box.tag }}</span>
										</label>
									{% endfor %}
									</div>

								<div class="my-2 d-flex w-100">
									<span class="align-self-center" style="vertical-align: middle;">Others: </span>
									<span class="flex-fill">{{ formfields.preferredstyleOthers }}</span>
								</div>
							</div>


							<div class="col-12 border border-dark">
								<div class="m-1 my-2">Preferred Neckline: </div>


									<div class="d-flex w-100 flex-wrap">
									{% for box in formfields.preferredNeckline %}
										<div class="d-flex flex-column col-3 p-0 my-3 align-items-center" for="{{ box.id_for_label }}">

											<div class="d-flex my-1 w-100 justify-content-center align-items-center">
												<span class="mx-2 align-middle">{{ box.choice_label }}</span>
												<span class="radio align-middle">{{ box.tag }}</span>
											</div>

											{% with 'images/'|add:box.choice_label|add:'.png' as image_path %}
											<img class="" src="{% static image_path %}" style="height:75%;">
											{% endwith %}

										</div>
									{% endfor %}
									</div>

								<div class="my-2 d-flex w-100">
									<span class="align-self-center" style="vertical-align: middle;">Others: </span>
									<span class="flex-fill">{{ formfields.preferredNeckOthers }}</span>
								</div>


							</div>


						</div>

						<hr class="mt-5">
						<div class="w-100 text-center"> ----- For Official Use ----- </div>
						<hr class="mt-3">
						<div class="w-100 d-flex justify-content-end mb-2 pr-2"
						style=""
						>{{ formfields.attendant }}
						</div>


						{{ formfields.additionalnotes }}
						</form>
						<div class="w-100 d-flex justify-content-between pr-2">
							<div></div>
							<!-- <button id="log_acct_details_btn" type="submit" 
							class="btn btn-primary" name="log_acct_details">Log / Verify Client Acct</button> -->
						</div>
						<hr class="my-3">
						<div class="d-flex align-items-center px-3">
							<div id="statusdiv" class="d-flex">
								<div class="mr-3">Status:</div></div>
							<button id="submitformdetails_btn" onclick="submitformdetails_post();"
							class="btn btn-primary ml-auto" name="log_acct_details">Submit Form Details</button>
						</div>
						<hr class="my-3">
						<!-- acct details card -->
						<div class="card">
							<div class="card-header d-flex justify-content-between align-items-center pr-2">
								Account Details
								<button id="log_acct_details_btn" onclick=""
							class="btn btn-primary" name="log_acct_details">Log / Verify Client Acct</button>
							</div>
							<div id="acctdetailscardbody" class="card-body collapse">
								
							</div>
						</div>
						
					</div>
				</div>


	</div>
{% endblock %}

{% block bottomjs %}
	{% include 'statics/bottomjs.html' %}
	<script src="https://unpkg.com/gijgo@1.9.11/js/gijgo.min.js" type="text/javascript"></script>

	<script>


	function submitformdetails_post() {
	    console.log("Submitting Form Details to GS...") // sanity check
	    var formData = new FormData();
	    formData.append('bridename', $('#bridename').val());
        formData.append('groomname', $('#groomname').val());
        formData.append('phonenum', $('#phonenum').val());
        formData.append('emailfield', $('#emailfield').val());
        formData.append('howdidyouhear', $('#howdidyouhear').val());
        formData.append('eventdate1', $('#eventdate1').val());
        formData.append('eventtype1', $('#eventtype1').val());
        formData.append('eventvenue1', $('#eventvenue1').val());
        formData.append('eventdate2',$('#eventdate2').val());
        formData.append('eventtype2',$('#eventtype2').val());
        formData.append('eventvenue2',$('#eventvenue2').val());
        formData.append('eventdate3',$('#eventdate3').val());
        formData.append('eventtype3',$('#eventtype3').val());
        formData.append('eventvenue3',$('#eventvenue3').val());
        formData.append('requiredoutfit',[
        	$('#requiredoutfit_0:checked').length > 0 ? $('#requiredoutfit_0').val() : 'false',
        	$('#requiredoutfit_1:checked').length > 0 ? $('#requiredoutfit_1').val() : 'false',
        	]);
        formData.append('noofgowns',$('#noofgowns').val());
        formData.append('preferredoutfit', [
        	$('#preferredoutfit_0:checked').length > 0 ? $('#preferredoutfit_0').val() : 'false',
        	$('#preferredoutfit_1:checked').length > 0 ? $('#preferredoutfit_1').val() : 'false',
        	$('#preferredoutfit_2:checked').length > 0 ? $('#preferredoutfit_2').val() : 'false',
        	$('#preferredoutfit_3:checked').length > 0 ? $('#preferredoutfit_3').val() : 'false',
        	$('#preferredoutfit_4:checked').length > 0 ? $('#preferredoutfit_4').val() : 'false',
        	$('#preferredoutfit_5:checked').length > 0 ? $('#preferredoutfit_5').val() : 'false',
        	$('#preferredoutfit_6:checked').length > 0 ? $('#preferredoutfit_6').val() : 'false',
        	]);
        formData.append('preferredoutOthers',$('#preferredoutOthers').val());
        formData.append('preferredstyle',[
        	$('#preferredstyle_0:checked').length > 0 ? $('#preferredstyle_0').val() : 'false',
        	$('#preferredstyle_1:checked').length > 0 ? $('#preferredstyle_1').val() : 'false',
        	$('#preferredstyle_2:checked').length > 0 ? $('#preferredstyle_2').val() : 'false',
        	$('#preferredstyle_3:checked').length > 0 ? $('#preferredstyle_3').val() : 'false',
        	]);
        formData.append('preferredstyleOthers',$('#preferredstyleOthers').val());
        formData.append('preferredNeckline',[
        	$('#preferredNeckline_0:checked').length > 0 ? $('#preferredNeckline_0').val() : 'false',
        	$('#preferredNeckline_1:checked').length > 0 ? $('#preferredNeckline_1').val() : 'false',
        	$('#preferredNeckline_2:checked').length > 0 ? $('#preferredNeckline_2').val() : 'false',
        	$('#preferredNeckline_3:checked').length > 0 ? $('#preferredNeckline_3').val() : 'false',
        	$('#preferredNeckline_4:checked').length > 0 ? $('#preferredNeckline_4').val() : 'false',
        	$('#preferredNeckline_5:checked').length > 0 ? $('#preferredNeckline_5').val() : 'false',
        	]);
        formData.append('preferredNeckOthers',$('#preferredNeckOthers').val());
        formData.append('attendant',$('#attendant').val());
        formData.append('additionalnotes',$('#additionalnotes').val());
	    
	    $('#statusdiv').children("span").remove()
        $('#statusdiv').append("<span>Checking records for registered values...</span>")

	    $.ajax({
        url : "submitformdetails/", // the endpoint
        type : "POST", // http method
        data : formData,
    	processData: false,
    	contentType: false,
        		//{ bridename : $('#bridename').val(),
        		//groomname : $('#groomname').val(),
        		//phonenum : $('#phonenum').val(),
        		//emailfield : $('#emailfield').val(),
        		//howdidyouhear : $('#howdidyouhear').val(),
        		//eventdate1 : $('#eventdate1').val(),
        		//eventtype1 : $('#eventtype1').val(),
        		//eventvenue1 : $('#eventvenue1').val(),
        		//eventdate2 : $('#eventdate2').val(),
        		//eventtype2 : $('#eventtype2').val(),
        		//eventvenue2 : $('#eventvenue2').val(),
        		//requiredoutfit : $('#requiredoutfit').val(),
        		//noofgowns : $('#noofgowns').val(),
        		//preferredoutfit :["shit", "you"], 
        		//[//$('#preferredoutfit_6:checked').val()
        		//2, 1],
        		//preferredoutOthers : $('#preferredoutOthers').val(),
        		//preferredstyle : $('#preferredstyle').val(),
        		//preferredstyleOthers : $('#preferredstyleOthers').val(),
        		//preferredNeckline : $('#preferredNeckline').val(),
        		//preferredNeckOthers : $('#preferredNeckOthers').val(),
        		//attendant : $('#attendant').val(),
        		//additionalnotes : $('#additionalnotes').val(),
        	 //}, // data sent with the post request

        // handle a successful response
        success : function(json) {
            //console.log(json);
            console.log("success"); // another sanity check
            
            $('#statusdiv').children("span").remove() //removes ALL spans
            //$('#statusdiv').append("<span>Updated Form Details in Db.</span>")
            $('#statusdiv').append("<span>"+json["tabletform_msg"]+"</span>")

            $('#acctdetailscardbody').toggleClass("show", $('#acctdetailscardbody').children().length > 0 )
            //console.log();
        },

        // handle a non-successful response
        error : function(xhr,errmsg,err) {
            console.log(errmsg);
            console.log(xhr.status + ": " + xhr.responseText);
        }
    });
	};


    $(function () {
        $('#{{ formfields.eventdate1.id_for_label }}').datepicker({
        	uiLibrary: 'bootstrap4',
            format:'dd-mm-yyyy'
        });

        $('#{{ formfields.eventdate2.id_for_label }}').datepicker({
        	uiLibrary: 'bootstrap4',
            format:'dd-mm-yyyy'
        });

        $('#{{ formfields.eventdate3.id_for_label }}').datepicker({
        	uiLibrary: 'bootstrap4',
            format:'dd-mm-yyyy'
        });
    });


    // JS to Pass CSRF to Django Server
    $(function() {
    	// This function gets cookie with a given name
	    function getCookie(name) {
		    var cookieValue = null;
		    if (document.cookie && document.cookie != '') {
		        var cookies = document.cookie.split(';');
		        for (var i = 0; i < cookies.length; i++) {
		            var cookie = jQuery.trim(cookies[i]);
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) == (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}
		
		var csrftoken = getCookie('csrftoken');

		/*
		The functions below will create a header with csrftoken
		*/

		function csrfSafeMethod(method) {
		    // these HTTP methods do not require CSRF protection
		    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		}

		function sameOrigin(url) {
		    // test that a given url is a same-origin URL
		    // url could be relative or scheme relative or absolute
		    var host = document.location.host; // host + port
		    var protocol = document.location.protocol;
		    var sr_origin = '//' + host;
		    var origin = protocol + sr_origin;
		    // Allow absolute or scheme relative URLs to same origin
		    return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
		        (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
		        // or any other URL that isn't scheme relative or absolute i.e relative.
		        !(/^(\/\/|http:|https:).*/.test(url));
		}

		$.ajaxSetup({
	    beforeSend: function(xhr, settings) {
	        if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
	            // Send the token to same-origin, relative URLs only.
	            // Send the token only if the method warrants CSRF protection
	            // Using the CSRFToken value acquired earlier
	            xhr.setRequestHeader("X-CSRFToken", csrftoken);
	        }
	    }
		});
	});

	</script>

{% endblock %}